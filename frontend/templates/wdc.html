<html>
  <head>
    <meta charset="utf-8">
    <!--  In order to use promises, like this example, you will need to include this polyfill to add promises
        functionality to the built in Tableau WDC browser (it does not have ES6 functionality by default)  -->
    <script src="https://www.promisejs.org/polyfills/promise-7.0.4.min.js"></script>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js" type="text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>

    <script>
      (function() {
    // Create the connector object
    var myConnector = tableau.makeConnector();

    // Define the schema
    myConnector.getSchema = function(schemaCallback) {
        var cols = [
            {id: 'participant_id', dataType: tableau.dataTypeEnum.string,},
            {id: 'study_id', dataType: tableau.dataTypeEnum.string,},
            {id: 'date', dataType: tableau.dataTypeEnum.string,},
            {id: 'distance_diameter', dataType: tableau.dataTypeEnum.string,},
            {id: 'distance_from_home', dataType: tableau.dataTypeEnum.string,},
            {id: 'distance_traveled', dataType: tableau.dataTypeEnum.string,},
            {id: 'flight_distance_average', dataType: tableau.dataTypeEnum.string,},
            {id: 'flight_distance_standard_deviation', dataType: tableau.dataTypeEnum.string,},
            {id: 'flight_duration_average', dataType: tableau.dataTypeEnum.string,},
            {id: 'flight_duration_standard_deviation', dataType: tableau.dataTypeEnum.string,},
            {id: 'gps_data_missing_duration', dataType: tableau.dataTypeEnum.string,},
            {id: 'home_duration', dataType: tableau.dataTypeEnum.string,},
            {id: 'physical_circadian_rhythm', dataType: tableau.dataTypeEnum.string,},
            {id: 'physical_circadian_rhythm_stratified', dataType: tableau.dataTypeEnum.string,},
            {id: 'radius_of_gyration', dataType: tableau.dataTypeEnum.string,},
            {id: 'significant_location_count', dataType: tableau.dataTypeEnum.string,},
            {id: 'significant_location_entropy', dataType: tableau.dataTypeEnum.string,},
            {id: 'stationary_fraction', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_incoming_count', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_incoming_degree', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_incoming_length', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_incoming_responsiveness', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_outgoing_count', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_outgoing_degree', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_outgoing_length', dataType: tableau.dataTypeEnum.string,},
            {id: 'text_reciprocity', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_incoming_count', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_incoming_degree', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_incoming_duration', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_incoming_responsiveness', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_outgoing_count', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_outgoing_degree', dataType: tableau.dataTypeEnum.string,},
            {id: 'call_outgoing_duration', dataType: tableau.dataTypeEnum.string,},
            {id: 'acceleration_direction', dataType: tableau.dataTypeEnum.string,},
            {id: 'accelerometer_coverage_fraction', dataType: tableau.dataTypeEnum.string,},
            {id: 'accelerometer_signal_variability', dataType: tableau.dataTypeEnum.string,},
            {id: 'accelerometer_univariate_summaries', dataType: tableau.dataTypeEnum.string,},
            {id: 'device_proximity', dataType: tableau.dataTypeEnum.string,},
            {id: 'total_power_events', dataType: tableau.dataTypeEnum.string,},
            {id: 'total_screen_events', dataType: tableau.dataTypeEnum.string,},
            {id: 'total_unlock_events', dataType: tableau.dataTypeEnum.string,},
            {id: 'awake_onset_time', dataType: tableau.dataTypeEnum.string,},
            {id: 'sleep_duration', dataType: tableau.dataTypeEnum.string,},
            {id: 'sleep_onset_time', dataType: tableau.dataTypeEnum.string,},
          ];

        var tableSchema = {
            id: "earthquakeFeed",
            alias: "Earthquakes with magnitude greater than 4.5 in the last seven days",
            columns: cols
        };

        schemaCallback([tableSchema]);
    };

    // Download the data
    myConnector.getData = function(table, doneCallback) {
        $.getJSON("http://localhost:8080/api/v0/studies/123456789012345678901234/summary-statistics/daily", function(resp) {
            table.appendRows(resp);
            doneCallback();
        });
    };

    tableau.registerConnector(myConnector);

    // Create event listeners for when the user submits the form
    $(document).ready(function() {
        $("#submitButton").click(function() {
          alert('hi')
            tableau.connectionName = "USGS Earthquake Feed"; // This will be the data source name in Tableau
            tableau.submit(); // This sends the connector object to Tableau
        });
    });
})();

    </script>
  </head>
  <body>
    <h1>JSON Placeholder Web Data Connector <br> Standard Connections</h1>
    <p>Example Web Data Connector demonstrating the Standard Connections feature <br>using the <a
        href="http://jsonplaceholder.typicode.com/">JSON Placeholder REST service</a>.</p>
    <button id="submitButton">Get Data</button>
    <script type='text/javascript' src='https://prod-useast-a.online.tableau.com/javascripts/api/viz_v1.js'></script>
    <div class='tableauPlaceholder' style='width: 1862px; height: 873px;'>
      <object class='tableauViz' width='1862' height='873' style='display:none;'>
        <param name='host_url' value='https%3A%2F%2Fprod-useast-a.online.tableau.com%2F' />
        <param name='embed_code_version' value='3' />
        <param name='site_root' value='&#47;t&#47;beiwedevalvin' />
        <param name='name' value='Regional&#47;Obesity' />
        <param name='tabs' value='yes' />
        <param name='toolbar' value='yes' />
        <param name='showAppBanner' value='false' />
      </object>
    </div>
  </body>
</html>